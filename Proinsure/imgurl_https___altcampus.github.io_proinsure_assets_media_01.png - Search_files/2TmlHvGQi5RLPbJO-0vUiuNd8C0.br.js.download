var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ImageDetailSwipe,__assign,Multimedia;(function(n){var t;(function(t){var f=n.ImageDetailUtils.setCropBoxAnimationProperty,e=n.ImageDetailUtils.isRTL,o=n.ImageDetailUtils.calculateRegionDifference,s=n.ImageDetailUtils.InsightsModuleType,i=ImageDetailReducers,u="undefined",r=null,h=function(h){function c(t){var f=h.call(this,t)||this;return f.px="px",f.startAnimationClassName="start",f.endAnimationClassName="end",f.readyAnimationClassName="ready",f.cropboxHintShown="mm.detail.crophint",f.cropBoxContentAnimationTime=1e3,f.cropBoxHintAnimationTime=3500,f.lastCropCoordinates=null,f.cropBoxAnimationTime=null,f.shouldShowHint=!1,f.isCropping=!1,f.multiTouchMove=!1,f.containerHeight=null,f.containerWidth=null,f.hint=null,f.cropConfig=null,f.hasTouchStartTriggered=!1,f.enableLiveView=null,f.debounceDelay=100,f.cropboxArrowMovementStep=15,f.enableMobileView=i===null||i===void 0?void 0:i.isMobileViewEnabled(),f.componentWillUnmount=function(){f.setSessionStorage();f.handleEventsSetting(!1)},f.isSessionStorageEnabled=function(){var n=!1;try{n="object"==typeof _w.sessionStorage}catch(t){}return n},f.setSessionStorage=function(){f.shouldShowHint&&f.isSessionStorageEnabled()&&(sessionStorage.setItem(f.cropboxHintShown,"1"),f.shouldShowHint=!1)},f.getViewRect=function(){if(!f.imageElement||!r)return null;var n=f.imageElement.clientLeft,t=f.imageElement.clientTop,i=Math.min(f.imageElement.clientWidth,f.containerWidth),u=Math.min(f.imageElement.clientHeight,f.containerHeight),e={x:n,y:t},o={x:n+i,y:t+u};return new r(e,o)},f.getCropRect=function(n){if(!f.imageElement||!r)return null;var o=f.imageElement.clientLeft,s=f.imageElement.clientTop,t=Math.min(f.imageElement.clientWidth,f.containerWidth),i=Math.min(f.imageElement.clientHeight,f.containerHeight),u=o+Math.round(t*n.left()),e=s+Math.round(i*n.top()),h=u+Math.round(t*n.width()),c=e+Math.round(i*n.height()),l={x:u,y:e},a={x:h,y:c};return new r(l,a)},f.start=function(n){f.overlayView!=null&&(f.startCropRect=f.overlayView.cropRect().clone(),f.overlayView.setStartPoint(n))},f.move=function(n){f.overlayView!=null&&f.startCropRect!=null&&(f.overlayView.setCurrPoint(n),f.overlayView.setCropRect(f.startCropRect.clone()),f.overlayView.update(),f.updateCropBoxStyle())},f.end=function(){f.throttleCropBoxChange()},f.cropBoxChange=function(){var n=f.getCropCoordinates(),t;n==null||f.isTinyChange(f.lastCropCoordinates,n)||(t={left:n.left(),top:n.top(),right:n.right(),bottom:n.bottom()},f.lastCropCoordinates=n,f.props.changeCropCoordinates(t))},f.setCropBoxState=function(n,t){r&&(f.startCropRect=new r(n,t),f.overlayView.setCropRect(f.startCropRect),f.overlayView.setStartPoint(n),f.overlayView.setCurrPoint(n),f.overlayView.update(),f.updateCropBoxStyle())},f.updateCropBoxStyle=function(){if(f.overlayView!=null){var n=f.overlayView.cropRect();f.update(n)}},f.getCropCoordinates=function(){var i,t,n,u,e;return f.overlayView==null||!r||(t=f.overlayView.cropRect(),n=f.overlayView.viewRect(),n.width()>0&&n.height()>0&&(u={x:t.left()/n.width(),y:t.top()/n.height()},e={x:t.right()/n.width(),y:t.bottom()/n.height()},i=new r(u,e))),i},f.isTinyChange=function(n,t){if(f.overlayView!=null&&f.overlayView.cropRect()!=null&&f.overlayView.cropRect().width()<=f.config.minDelta&&f.overlayView.cropRect().height()<=f.config.minDelta)return!0;if(n&&t){var i=o(n.transformToRegion(),t.transformToRegion());if(i<f.config.minDelta)return!0}return!1},f.throttle=function(n,t){var i,r;return function(){clearTimeout(r);var f=this,e=arguments,u=Number(new Date);i&&u<i+t?r=setTimeout(function(){i=u;n.apply(f,e)},i+t-u):(i=u,n.apply(f,e))}},f.cancelAnimation=function(n){n&&(n.classList.remove(f.startAnimationClassName),n.classList.add(f.endAnimationClassName))},f.startAnimation=function(n){n&&(n.classList.add(f.readyAnimationClassName),f.isAnimationEnabled()&&n.classList.add(f.startAnimationClassName))},f.endAnimation=function(n,t){if(n){var i=f.cancelAnimation;f.isAnimationEnabled()?setTimeout(function(){i(n)},t):f.cancelAnimation(n)}},f.setAnimations=function(){f.startAnimation(f.cropBox);f.startAnimation(f.cropBoxContent);f.startAnimation(f.cropBoxHint);f.endAnimation(f.cropBox,f.cropBoxAnimationTime);f.endAnimation(f.cropBoxContent,f.cropBoxContentAnimationTime);f.endAnimation(f.cropBoxHint,f.cropBoxHintAnimationTime)},f.update=function(n){if(f.cropBox&&n){var i=n.top(),t=n.left(),r=n.height(),u=n.width();e?f.cropBox.style.right=t+f.px:f.cropBox.style.left=t+f.px;f.cropBox.style.top=i+f.px;f.cropBox.style.width=u+f.px;f.cropBox.style.height=r+f.px;f.ImageCropBoxPin&&f.ImageCropBoxPin.setStyle(i,t,r,u)}},f.getOffsetPosition=function(n,t,i){var r=n.getBoundingClientRect(),u=t-r.left,f=i-r.top;return{x:u,y:f}},f.getTouchPosition=function(n,t){return n&&n.touches?f.getOffsetPosition(f.imageElement,n.touches[t].clientX,n.touches[t].clientY):null},f.getMousePosition=function(n){return f.getOffsetPosition(f.imageElement,n.clientX,n.clientY)},f.onTouchStart=function(n){if(f.hasTouchStartTriggered=!0,n&&n.touches)f.start(f.getTouchPosition(n,0));else f.onMouseDown(n);f.enableLiveView&&f.props.changeInsightsScrollPosition()},f.onMouseDown=function(n){if(f.isPositionWithinBoundary(f.imageElement,n.clientX,n.clientY)){f.isCropping=!0;var t=f.getMousePosition(n);f.start(t)}},f.onTouchMove=function(n){if(n&&n.touches)if(f.config.enableMultiTouchRedraw&&n.touches.length>=2){f.multiTouchMove=!0;var t=f.getTouchPosition(n,0),i=f.getTouchPosition(n,1);f.setCropBoxState(t,i);f.stopPropagation(n)}else!f.multiTouchMove&&f.overlayView.isTransforming()&&(f.move(f.getTouchPosition(n,0)),f.stopPropagation(n));else f.onMouseMove(n)},f.onMouseMove=function(t){var i,r,u;f.isCropping&&(i=f.getMousePosition(t),f.overlayView.isTransforming()?f.move(i):f.config.enableMouseRedraw&&(r={x:i.x,y:i.y},u={x:i.x+1,y:i.y+1},f.setCropBoxState(r,u)),f.props.inTextMode&&f.debouncedOCRIntersectionsChangeHandler(n.TextRecognitionUtils.getSelectedArea(f.overlayView.cropRect(),f.overlayView.viewRect())),f.stopPropagation(t))},f.onTouchEnd=function(n){if(n&&n.touches)f.end(),n.touches.length===0&&(f.multiTouchMove=!1),f.stopPropagation(n);else f.onMouseUp(n);f.hasTouchStartTriggered=!1},f.onDocumentTouchEnd=function(n){if(f.hasTouchStartTriggered)f.onTouchEnd(n)},f.onMouseUp=function(){if(f.isCropping=!1,typeof _w!="undefined"){var n=_w.getSelection();n&&n.type=="Range"&&n.removeAllRanges()}f.overlayView.verifyMinimumSize();f.end()},f.isPositionWithinBoundary=function(n,t,i){var r=n.getBoundingClientRect();return t<r.left||t>r.right||i<r.top||i>r.bottom?!1:!0},f.handleEventsSetting=function(n){var t=n?sj_be:sj_ue,i=typeof sb_de!==u;typeof t!==u&&(i&&"ontouchstart"in sb_de?(t(f.imageElement,"touchstart",f.onTouchStart,!0),t(f.imageElement,"touchmove",f.onTouchMove,!0),t(f.imageElement,"touchend",f.onTouchEnd,!0)):window.navigator.msPointerEnabled?(f.imageElement.style.msTouchAction="none",f.imageElement.style.touchAction="none",t(f.imageElement,"MSPointerDown",f.onTouchStart,!0),t(f.imageElement,"MSPointerMove",f.onTouchMove,!0),t(f.imageElement,"MSPointerUp",f.onTouchEnd,!0),t(_d,"MSPointerUp",f.onDocumentTouchEnd,!0)):i&&"onpointermove"in sb_de&&(f.imageElement.style.msTouchAction="none",f.imageElement.style.touchAction="none",t(f.imageElement,"pointerdown",f.onTouchStart,!0),t(f.imageElement,"pointermove",f.onTouchMove,!0),t(f.imageElement,"pointerup",f.onTouchEnd,!0),t(_d,"pointerup",f.onDocumentTouchEnd,!0)),t(f.imageElement,"mousedown",f.onMouseDown,!0),t(f.imageElement,"mousemove",f.onMouseMove,!0),t(f.imageElement,"mouseup",f.onMouseUp,!0))},f.handleKeyPress_leftTop=function(n){var t=f.overlayView.cropRect(),i={x:t.left(),y:t.top()};f.handleKeyPress(n,i)},f.handleKeyPress_rightTop=function(n){var t=f.overlayView.cropRect(),i={x:t.right(),y:t.top()};f.handleKeyPress(n,i)},f.handleKeyPress_leftBottom=function(n){var t=f.overlayView.cropRect(),i={x:t.left(),y:t.bottom()};f.handleKeyPress(n,i)},f.handleKeyPress_rightBottom=function(n){var t=f.overlayView.cropRect(),i={x:t.right(),y:t.bottom()};f.handleKeyPress(n,i)},f.handleKeyPress=function(n,t){var i=Object.assign({},t),r=!1;switch(n.keyCode){case 37:i.x-=f.cropboxArrowMovementStep;r=!0;break;case 39:i.x+=f.cropboxArrowMovementStep;r=!0;break;case 38:i.y-=f.cropboxArrowMovementStep;r=!0;break;case 40:i.y+=f.cropboxArrowMovementStep;r=!0}r&&(f.start(t),f.move(t),f.move(i),f.end(),f.stopPropagation(n))},r=typeof MmGeometry!==u?MmGeometry.Rectangle:null,f.enableLiveView=typeof i.ilv!="undefined"?i.ilv():!1,f.cropConfig=i.getCropConfig(),f.shouldShowHint=!f.cropConfig.eft&&f.isSessionStorageEnabled()&&sessionStorage.getItem(f.cropboxHintShown)!=="1",f.hint=f.cropConfig.hnt,f.debouncedOCRIntersectionsChangeHandler=n.ImageDetailUtils.debounce(f.props.changeIntersectedOCRRegions,f.debounceDelay),f}return __extends(c,h),c.prototype.componentWillMount=function(){this.props&&(this.config=new ImageVisualSearchCropBox.CropBoxClientConfig(this.cropConfig),this.isCropping=this.props.isDirectDrawing,this.cropBoxAnimationTime=this.config.animationDuration,this.containerWidth=this.props.containerWidth,this.containerHeight=this.props.containerHeight)},c.prototype.componentDidMount=function(){var t,i,u,n;(this.throttleCropBoxChange=this.throttle(this.cropBoxChange,this.config.eventTimeThreshold),t=this.props.cropCoordinates?this.props.cropCoordinates:this.config,r)&&(this.isCropping&&this.props.dragEvent?(u=this.getMousePosition(this.props.dragEvent),i=new r({x:u.x,y:u.y},{x:u.x+this.config.minDelta,y:u.y+this.config.minDelta}),this.overlayView=new VisualSearchCropBoxUtils.OverlayView(this.getViewRect(),i,this.config)):(i=new r({x:t.left,y:t.top},{x:t.right,y:t.bottom}),this.overlayView=new VisualSearchCropBoxUtils.OverlayView(this.getViewRect(),this.getCropRect(i),this.config)),n=this.overlayView.cropRect(),n&&f(n.width(),n.height(),n.left(),n.top()),this.isAnimationEnabled()?setTimeout(this.updateCropBoxStyle,this.cropBoxAnimationTime):this.updateCropBoxStyle(),this.setAnimations(),this.props.cropCoordinates?this.lastCropCoordinates=i:this.throttleCropBoxChange(),this.handleEventsSetting(!0),this.leftTopElement&&this.props.isCropBoxFocused&&(this.leftTopElement.classList.remove("nofocus"),this.leftTopElement.focus()))},c.prototype.componentWillReceiveProps=function(n){if(n.cropCoordinates&&this.overlayView!=null&&!!r){var t=new r({x:n.cropCoordinates.left,y:n.cropCoordinates.top},{x:n.cropCoordinates.right,y:n.cropCoordinates.bottom});t.equals(this.lastCropCoordinates)&&this.containerHeight==n.containerHeight&&this.containerWidth==n.containerWidth||(this.containerHeight=n.containerHeight,this.containerWidth=n.containerWidth,this.overlayView.setViewRect(this.getViewRect()),this.overlayView.setCropRect(this.getCropRect(t)),this.lastCropCoordinates=t,this.updateCropBoxStyle(),this.setState({coordinates:t,containerHeight:n.containerHeight,containerWidth:n.containerWidth}))}},c.prototype.isAnimationEnabled=function(){return this.config.enableAnimations&&!this.props.isFromOverlayElement&&!this.props.isDirectDrawing},c.prototype.isCloseButtonEnabled=function(){return this.config.enableCloseButton},c.prototype.stopPropagation=function(n){n.preventDefault();n.stopPropagation()},c.prototype.render=function(){var i=this,r="cropRect";return(r+=this.isCloseButtonEnabled()?" rb":"",this.props)?React.createElement("div",{id:"overlay_view",className:"overlayView",ref:function(n){i.imageElement=n}},this.enableLiveView&&React.createElement(n.ImageDetail.ImageCropBoxPin,{setMainImageVerticalScroll:this.props.setMainImageVerticalScroll,ref:function(n){i.ImageCropBoxPin=n}}),React.createElement("div",{id:"crop_rect",className:r,ref:function(n){i.cropBox=n}},React.createElement("div",{className:"content",ref:function(n){i.cropBoxContent=n}},React.createElement("div",{className:"left"}),React.createElement("div",{className:"right"}),React.createElement("div",{className:"top"}),React.createElement("div",{className:"bottom"}),React.createElement(SharedComponent.AccessibleComponent,{className:"leftTop",ariaLabel:this.cropConfig.tln,role:"button",onKeyDown:this.handleKeyPress_leftTop,reference:function(n){i.leftTopElement=n}}),React.createElement(SharedComponent.AccessibleComponent,{className:"rightTop",ariaLabel:this.cropConfig.trn,role:"button",onKeyDown:this.handleKeyPress_rightTop}),React.createElement(SharedComponent.AccessibleComponent,{className:"leftBottom",ariaLabel:this.cropConfig.bln,role:"button",onKeyDown:this.handleKeyPress_leftBottom}),React.createElement(SharedComponent.AccessibleComponent,{className:"rightBottom",ariaLabel:this.cropConfig.brn,role:"button",onKeyDown:this.handleKeyPress_rightBottom}),this.isCloseButtonEnabled()&&React.createElement(t.RemoveCropAction,{hideText:!0})),!this.enableMobileView&&this.props.selectedModule===n.ImageDetailUtils.getModuleName(s.homework)&&typeof t.GetAnswerButton!==u&&React.createElement(t.GetAnswerButton,null)),this.shouldShowHint&&React.createElement("span",{className:"cropBoxHint",ref:function(n){i.cropBoxHint=n}},this.hint),this.config.enableDotAnimation&&n.ImageDetail.ImageCropBoxDotAnimation!=undefined?React.createElement(n.ImageDetail.ImageCropBoxDotAnimation,null):null):null},c}(React.Component),c=function(n){return{changeCropCoordinates:function(t){t&&n(ImageDetailActions.changeCropCoordinates(t))},changeInsightsScrollPosition:function(){n(ImageDetailActions.changeInsightsScrollPosition(ImageDetailActions.InsightsScrollPosition.Peek))},changeIntersectedOCRRegions:function(t){typeof ImageDetailActions.changeIntersectedTextRegions!=u&&n(ImageDetailActions.changeIntersectedTextRegions(t))}}},l=function(n){var t=i.getInsightsViewState(n),r=t===null||t===void 0?void 0:t.selectedModule,f=i.getIsHotspotClick(n)||i.getClickedEntity(n);return{cropCoordinates:i.getCropCoordinates(n),isFromOverlayElement:!!f,inTextMode:typeof i.itm!==u&&i.itm(n),isCropBoxFocused:typeof i.isCropElementFocused=="function"?i.isCropElementFocused(n):!1,selectedModule:r}},a=ReactRedux.connect(l,c);t.ImageCropBox=a(h)})(t=n.ImageDetail||(n.ImageDetail={}))})(Multimedia||(Multimedia={}));__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},function(n){var t;(function(){var u=ImageDetailActions.IImageDetailOverlayElement,f=ImageDetailActions.EventActionType,i=n.ImageDetailUtils.InsightsModuleType,e=ImageDetailActions.IImageDetailViewType,o=n.ImageDetailUtils,r="undefined",t=ImageDetailReducers;n.ImageDetail.withHotspotData=function(n,s){function h(n){return React.createElement(v,__assign({},n))}var c=function(n){return{changeCropCoordinates:function(t){n(ImageDetailActions.changeCropCoordinates(t,!0))},changeHiddenCropCoordinates:function(t){typeof ImageDetailActions.changeHiddenCropCoordinates!==r&&n(ImageDetailActions.changeHiddenCropCoordinates(t))},addToDetailStateHistory:function(){n(ImageDetailActions.addToDetailStateHistory())},changePageView:function(){n(ImageDetailActions.changePageView(e.VisualSearch))},changeSelectedModule:function(t){var r=t?i[i.all]:i[i.productandads];n(ImageDetailActions.changeInsightsSelectedModule(r))},changeInsightsStatus:function(t){n(ImageDetailActions.changeInsightStatus(!0,t,"ObjectDetection"))},changeEnableSyntheticHotspotClick:function(t){n(ImageDetailActions.ChangeEnableSyntheticHotspotClick(t))},changeSelectedObjectIndex:function(t){typeof ImageDetailActions.changeSelectedObjectIndex!==r&&n(ImageDetailActions.changeSelectedObjectIndex(t))}}},l=function(n){var i,e,o=t.getCurrentResult(n),l=t.gpc().disAdltVs,a=(i=l&&o&&o.isAdult?null:t.getDetectedObjects(n))!==null&&i!==void 0?i:[],h=t.getVisibleOverlayElements(n),v=h&&h.some(function(n){return n.type===u.Hotspot&&n.id==null}),c=t.getObjectDetectionConfig(n),y=t.gmio?(e=t.gmio(n))===null||e===void 0?void 0:e.imageInfo:null,p=t.getImageStateById(n,n.displayInsightsId);return{detectedObjects:a,config:c,hotspotModuleConfig:s,enableAllTabOnClick:c.EnableAllTabOnClick,detailScenario:t.getDetailScenario(n),showHotspotWithoutHover:v,imageData:o,imageState:p,viewType:t.getViewType(n),ig:t.getCurrentImpressionId(n),syntheticClick:typeof t.geshsc!=r?t.geshsc(n):f.None,selectedObjectIndex:typeof t.gsoi!=r?t.gsoi(n):-1,isMultiImageActive:!!y}},a=ReactRedux.connect(l,c),v=a(n);return h.displayName="ModuleWithHotSpotData(".concat(o.gdnm(n),")"),h}})(t=n.ImageDetail||(n.ImageDetail={}))}(Multimedia||(Multimedia={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},function(n){var t;(function(t){var e=n.InstrumentationUtils.lac,o=n.InstrumentationUtils.la,s=ImageDetailReducers.getResourceString,f=ImageDetailActions.IClickTarget,i=ImageDetailActions.EventActionType,h=n.ImageDetail.withHotspotData,c=ImageDetailReducers,u=n.ImageDetailUtils,r="undefined",l=function(h){function l(s){var l=h.call(this,s)||this;return l.hotSpots=[],l.defaultHoverShown=!1,l.hotSpotTooltip=null,l.handleSyntheticClick=function(n){if(n.detectedObjects&&n.detectedObjects.length>0){var t=0;typeof u.ghtptla=="function"&&n.detectedObjects.length>1&&(t=u.ghtptla(n.detectedObjects));o("CI.Info","NoResults.Fallback",n.ig);l.handleClickOnHotSpotElement(n.detectedObjects[t],t)}typeof i!==r&&n.changeEnableSyntheticHotspotClick(i.Completed)},l.changeCropCoordinatesAndLoadVisualSearch=function(n,t){if(n){l.props.changeCropCoordinates(n);l.enableClickChangeHiddenCrop&&l.props.changeHiddenCropCoordinates(n);l.props.changeSelectedModule(l.props.enableAllTabOnClick);l.props.changeSelectedObjectIndex(t);var i=ImageDetailActions.IImageDetailViewType.VisualSearch;l.enableClickChangeHiddenCrop||l.props.viewType===i||(l.props.addToDetailStateHistory(),l.props.changeInsightsStatus(l.props.ig),l.props.changePageView())}},l.stopPropagation=function(n){n.stopPropagation&&n.stopPropagation();n.preventDefault&&n.preventDefault()},l.handleUserAction=function(n,t){l.stopPropagation(n);l.handleClickOnHotSpot(t)},l.handleClickOnHotSpot=function(n){var t=l.props.detectedObjects[n];l.handleClickOnHotSpotElement(t,n)},l.handleClickOnHotSpotElement=function(i,o){var s=i&&i.boundingBox,h,c,a,v;if(s){h=i.hotspot;c=h?"left:"+h.left+", top:"+h.top:"";l.props.imageData&&l.props.imageData.instInfo&&e("ObjectDetectionHotSpot",l.props.ig,{Info:c},l.props.imageData.instInfo);switch(l.clickTarget){case f.Requery:typeof t.ObjectDetectionRequery.getRequeryUrl!==r&&typeof t.ObjectDetectionRequery.getHotspotQuery!==r&&(a=t.ObjectDetectionRequery.getHotspotQuery(i.displayName),u.gecc(t.ObjectDetectionRequery.getRequeryUrl(a))());break;case f.External:v={result:l.props.imageData,insightsViewState:{viewType:ImageDetailActions.IImageDetailViewType.VisualSearch},cropcoordinates:{top:s.top,bottom:s.bottom,left:s.left,right:s.right}};u.gecc(n.ImageDetailLocationUtils.getSearchByImageUploadUrl(v,!0))();break;default:l.changeCropCoordinatesAndLoadVisualSearch(s,o)}}},l.enableClickChangeHiddenCrop=c.gpc().echcr,l.clickTarget=s.config?s.config.ClickTarget:f.DetailPage,l}return __extends(l,h),l.prototype.componentDidMount=function(){typeof i!==r&&this.props.syntheticClick===i.Requested&&this.handleSyntheticClick(this.props)},l.prototype.componentWillUpdate=function(){this.hotSpots=[]},l.prototype.componentWillReceiveProps=function(n){typeof i!==r&&n.syntheticClick===i.Requested&&this.props.syntheticClick===i.None&&this.handleSyntheticClick(n)},l.prototype.componentDidUpdate=function(){if(this.props.setMainImageVerticalScroll&&typeof u.getOverlap!=r&&this.hotSpots&&this.hotSpots.length>0&&this.props.selectedObjectIndex>=0){var n=u.getOverlap(this.hotSpots[this.props.selectedObjectIndex],_d.querySelector(".img_bop"));console.log("selectedObjectIndex: "+this.props.selectedObjectIndex);console.log("overlap with selectedOgject: "+n);n>0&&this.props.setMainImageVerticalScroll(-n)}},l.prototype.render=function(){var n=this;if(this.props&&this.props.config&&this.props.config.Enabled&&this.props.detectedObjects&&this.props.detectedObjects.length>0&&!this.props.isMultiImageActive){this.hotSpotTooltip=this.hotSpotTooltip?this.hotSpotTooltip:s("HSTooltip");var i=this.props.config.EnableTooltip?this.hotSpotTooltip:"",u=i?{"data-tooltip":i}:{},e=this.props.showHotspotWithoutHover?"obj_det_container show":"obj_det_container";return React.createElement("div",{className:e,id:"obj_det_container"},this.props.detectedObjects.map(function(i,e){var o,c,s,h;if(i.hotspot)return o=e==0&&n.props.config.EnableNotification&&!n.defaultHoverShown?"obj_det hover":"obj_det",o+=e===n.props.selectedObjectIndex?" selected":"",c={left:i.hotspot.left*100+"%",top:i.hotspot.top*100+"%"},s=void 0,n.clickTarget==f.Requery&&typeof t.ObjectDetectionRequery.getHotspotQuery!==r&&(s=t.ObjectDetectionRequery.getHotspotQuery(i.displayName)),i.hotspot.left<.2&&(o+=" left-tooltip"),i.hotspot.left>.8&&(o+=" right-tooltip"),h="core",n.props.config.EnableHotSpotIcon&&(h+=" icon-hotspot"),React.createElement(SharedComponent.AccessibleComponent,__assign({elementName:"span"},u,{className:o,key:e,style:c,onMouseDown:function(t){return n.handleUserAction(t,e)},onTouchEnd:function(t){return n.handleUserAction(t,e)},reference:function(t){t&&n.hotSpots.push(t)}}),React.createElement("span",{className:h},s))}))}return null},l}(React.Component);n.ImageDetail.ObjectDetection=h(l);n.ImageDetail.ObjectDetection.displayName="ObjectDetection"})(t=n.ImageDetail||(n.ImageDetail={}))}(Multimedia||(Multimedia={})),function(n){var t=function(){function n(n,t,i,r,u,f,e,o,s){e===void 0&&(e=!0);o===void 0&&(o=5);s===void 0&&(s=!1);var h=this;if(this.utils=pMMUtils,this.moved=!1,this.doubletap=!1,this.touchStartPoint=null,this.touchStartElementLeft=0,this.nowtouchpid=0,this.swipeDelta=null,this.touchStartTime=0,this.timeDelta=0,this.captureEvent=!0,this.enableEndHandlerWithoutMove=!1,this.moveSensitivity=5,this.cleanUp=function(){h.handleEventsSetting(!1)},this.isMoved=function(){return h.moved},this.resetMoved=function(){h.moved=!1},this.handleEventsSetting=function(n){var t=n?sj_be:sj_ue;typeof sb_de!="undefined"&&("ontouchstart"in sb_de?(t(h.touchElement,"touchstart",h.touchStart,h.captureEvent),t(h.touchElement,"touchmove",h.touchMove,h.captureEvent),t(h.touchElement,"touchend",h.touchEnd,h.captureEvent)):window.navigator.msPointerEnabled?(h.touchElement.style.msTouchAction="none",h.touchElement.style.touchAction="none",t(h.touchElement,"MSPointerDown",h.touchStart,h.captureEvent),t(h.touchElement,"MSPointerMove",h.touchMove,h.captureEvent),t(h.touchElement,"MSPointerUp",h.touchEnd,h.captureEvent),t(_d,"MSPointerUp",h.touchEnd,h.captureEvent)):"onpointermove"in sb_de&&(h.touchElement.style.msTouchAction="none",h.touchElement.style.touchAction="none",t(h.touchElement,"pointerdown",h.touchStart,h.captureEvent),t(h.touchElement,"pointermove",h.touchMove,h.captureEvent),t(h.touchElement,"pointerup",h.touchEnd,h.captureEvent),t(_d,"pointerup",h.touchEnd,h.captureEvent)),t(_d,"mousedown",h.resetMoved,!0))},this.getHandlerOrEmpty=function(n){return n!=null?n:h.Empty},this.Empty=function(){},this.setMoved=function(n){n===void 0&&(n=!1);h.moved=n},this.checkIfDoubleTap=function(){return sb_gt()-h.touchStartTime<250&&!!h.doubleTapHandler&&!h.isMoved()},this.touchStart=function(n){if(h.isTouchEvent(n)&&(h.doubletap=h.checkIfDoubleTap(),!h.doubletap)){h.setMoved(!1);h.touchStartPoint=h.getTouchPointFromEvent(n);var t=h.utils.gcs(h.touchElement);h.touchStartElementLeft=parseInt(typeof _G!="undefined"&&_G.RTL?t.marginRight:t.marginLeft);h.touchStartTime=sb_gt();!n.pointerId||(h.nowtouchpid=n.pointerId);h.touchStartHandler(n)}},this.touchMove=function(n){if(h.isTouchEvent(n)&&h.isValidTouch(n)){var t=h.getTouchPointFromEvent(n);if(!h.touchStartPoint||!t)return;h.swipeDelta=h.getDistanceBetweenPoints(h.touchStartPoint,t);h.setMoved(Math.abs(h.swipeDelta.X)>h.moveSensitivity||Math.abs(h.swipeDelta.Y)>h.moveSensitivity);h.isMoved()&&!h.doubletap&&h.touchMoveHandler(h.touchStartElementLeft,h.swipeDelta)&&h.preventDefault(n)}},this.touchEnd=function(n){var t=h.isMoved(),i;h.isTouchEvent(n)&&(h.doubletap&&!h.isMoved()?(h.doubleTapHandler(n),h.preventDefault(n),h.doubletap=!1):(t||h.enableEndHandlerWithoutMove)&&h.isValidTouch(n)&&(h.timeDelta=sb_gt()-h.touchStartTime,i=t?h.swipeDelta:h.getNewPoint(),h.touchEndHandler(h.touchStartElementLeft,i,h.timeDelta)&&h.preventDefault(n)),sj_ue(_d,"mousedown",h.resetMoved,!0),sb_st(function(){sj_be(_d,"mousedown",this.resetMoved,!0)},150))},this.preventDefault=function(n){n.stopPropagation();n.preventDefault()},this.getTouchPointFromEvent=function(n){var t=h.getNewPoint();return t.X=n.touches?n.touches[0].pageX:n.pageX!=undefined&&n.pageX!=0?n.pageX:0,t.Y=n.touches?n.touches[0].pageY:n.pageY!=undefined&&n.pageY!=0?n.pageY:0,t},this.getDistanceBetweenPoints=function(n,t){var i=h.getNewPoint();return i.X=t.X-n.X,i.Y=t.Y-n.Y,i},this.getNewPoint=function(){return{X:0,Y:0}},this.isTouchEvent=function(n){return typeof n.pointerType=="undefined"||n.pointerType==2||n.pointerType=="touch"||n.pointerType=="pen"},this.isValidTouch=function(n){return!n.pointerId||n.pointerId==h.nowtouchpid},!n)throw"container cannot be null!";this.container=n;this.touchElement=!t?this.container:t;this.touchStartHandler=this.getHandlerOrEmpty(i);this.touchMoveHandler=this.getHandlerOrEmpty(r);this.touchEndHandler=this.getHandlerOrEmpty(u);this.doubleTapHandler=this.getHandlerOrEmpty(f);this.enableEndHandlerWithoutMove=s;this.captureEvent=e;this.moveSensitivity=o;this.handleEventsSetting(!0)}return n}();n.MmReactSwipe=t}(ImageDetailSwipe||(ImageDetailSwipe={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},function(n){var t;(function(t){var s=n.InstrumentationUtils.lac,h=SharedInterfaces.IDetailMode,u=n.ImageDetailUtils.InsightsModuleType,i=ImageDetailReducers,f="undefined",c=" selected",e=" show",o=" hide",l=" pr",a=n.Utils,r=n.ImageDetailUtils,v=function(h){function v(e){var o=this,l,v,y,p,w,b,k,d,g,nt;return o=h.call(this,e)||this,o._isMounted=!1,o.hotspotInfo=n.TextRecognitionUtils.hotspotInfo,o.bboxInfo=n.TextRecognitionUtils.bboxInfo,o.compareBbox=n.TextRecognitionUtils.compareBbox,o.OcrRenderLevel=n.TextRecognitionUtils.OcrRenderLevel,o.calculateColor=typeof r.Translate!==f?(l=r.Translate)===null||l===void 0?void 0:l.calculateColor:undefined,o.findFontSizeForTextFit=typeof r.Translate!==f?(v=r.Translate)===null||v===void 0?void 0:v.findFontSizeForTextFit:undefined,o.tooltipEnabled=!0,o.renderLevel=o.OcrRenderLevel.Line,o.renderSvg=!0,o.defaultHotspotLocation=.05,o.fontScale=.7,o.epsilon=.01,o.regionElements=[],o.lineElements=[],o.wordElements=[],o.imageBitmap=null,o.isTextTranslateEnabled=(y=i.gdlc("gtc"))===null||y===void 0?void 0:y.itte,o.deafultShowCloseIcon=(p=i.gdlc("gtrc"))===null||p===void 0?void 0:p.civ,o.showTextModuleInVS=(w=i.gdlc("gtrc"))===null||w===void 0?void 0:w.stm,o.isFixTextModeIconEnabled=(b=i.gpc())===null||b===void 0?void 0:b.ftoe,o.hideCloseButton=function(){return!o.deafultShowCloseIcon||o.isTranslateModuleSelected()},o.showTextModeIcon=function(){return o.isFixTextModeIconEnabled?o.isTextModuleSelected():!0},o.isTranslateModuleSelected=function(){return o.props.selectedModule===r.getModuleName(u.translation)},o.isTextModuleSelected=function(){return o.props.selectedModule===r.getModuleName(u.text)},o.handleDragStartEvent=function(n){o.props.inTextMode&&o.enableDragSelection&&o.props.dragStart(n)},o.resetSelectedElements=function(n){var t=!1;return n.forEach(function(n){var i=!o.isTranslateModuleSelected()&&o.renderSvg?n.className.baseVal:n.className;i.indexOf(c)>0&&(n.setAttribute("class",i.replace(c,"")),t=!0)}),t},o.refreshDataElements=function(){var n=!1;o.regionElements&&o.resetSelectedElements(o.regionElements)&&(n=!0);o.lineElements&&o.resetSelectedElements(o.lineElements)&&(n=!0);o.wordElements&&o.resetSelectedElements(o.wordElements)&&(n=!0);n&&o.props.changeSelectedTextIndex(null)},o.toggleTextMode=function(){o.props.inTextMode&&o.refreshDataElements();var n=o.props.inTextMode?!o.props.inTextMode:!0,t=n?"Enter":"Exit";s("TextMode",o.props.ig,{Action:t,Source:n?"hotspot":"close"});o.props.changeTextMode(n);o.props.enableActionsFromIntent&&!n&&o.props.changeSelectedModule(r.getModuleName(u.all))},o.toPercentage=function(n){return n*100+"%"},o.toPixel=function(n,t,i){return n*t*i+"px"},o.toRadian=function(n){return"rotate("+n+"rad)"},o.createBbox=function(n,t,i,r,u,f){var e,s,h;if(!o.isTranslateModuleSelected()&&o.renderSvg)return s=n*100+i/2,h=t*100+r/2,{x:o.toPercentage(n),y:o.toPercentage(t),width:o.toPercentage(i),height:o.toPercentage(r),transform:o.toRadian(Math.round(u*1e3)/1e3),transformOrigin:"".concat(s,"% ").concat(h,"%")};var c=o.toPixel(r,o.props.imageHeight,o.fontScale),l=parseInt(c.replace("px",""),10),a=i*o.props.imageWidth;return{left:o.toPercentage(n),top:o.toPercentage(t),width:o.toPercentage(i),height:o.toPercentage(r),fontSize:o.isTranslateModuleSelected()&&o.findFontSizeForTextFit!==undefined?(e=o===null||o===void 0?void 0:o.findFontSizeForTextFit)===null||e===void 0?void 0:e.call(o,f,a,l):c,transform:o.toRadian(Math.round(u*1e3)/1e3),transformOrigin:"left top"}},o.selectText=function(n,t){var i=o.getOcrData(t),f=o.bboxInfo(i.boundingBox,i.text),e="left:"+f.left+", top:"+f.top,h={Text:f.text,Selected:!i.selected,Info:e};s("TextBoundingBox",o.props.ig,h);o.props.changeSelectedTextIndex(t);a.sp(n);o.props.selectedModule!==r.getModuleName(u.text)&&o.props.selectedModule!==r.getModuleName(u.translation)&&o.props.changeSelectedModule(r.getModuleName(u.text))},o.renderTextBoxes=function(n){var r,u;switch(o.renderLevel){case o.OcrRenderLevel.Region:return o.props.ocrData.map(function(i,r){return React.createElement(t.TextRecognitionRegion,{key:r,region:i,dataIndex:{region:r},htmlElements:n=="mask"?null:o.regionElements,elementType:n,selected:i.selected,textEnabled:o.renderText,createBbox:o.createBbox,selectText:o.selectText})});case o.OcrRenderLevel.Line:return r=[],o.props.ocrData.map(function(u,f){u.lines.map(function(u,e){var c,h,s;o.isTranslateModuleSelected()&&(o.imageBitmap&&(h=(c=o===null||o===void 0?void 0:o.calculateColor)===null||c===void 0?void 0:c.call(o,o.imageBitmap,u.boundingBox)),h||(s=i.gdlc("gtc"),h={bgColor:s===null||s===void 0?void 0:s.dbgc,textColor:s===null||s===void 0?void 0:s.dtc}));(!o.isTranslateModuleSelected()||o.isTranslateModuleSelected()&&h)&&r.push(React.createElement(t.TextRecognitionLine,{key:"".concat(f,"-").concat(e),line:u,imageWidth:o.props.imageWidth,imageHeight:o.props.imageHeight,dataIndex:{region:f,line:e},htmlElements:n=="mask"?null:o.lineElements,elementType:n,selected:u.selected,textEnabled:o.isTranslateModuleSelected()||o.renderText,shouldShowTranslatedText:o.isTranslateModuleSelected(),textBoxColor:h,createBbox:o.createBbox,selectText:o.selectText}))})}),r;case o.OcrRenderLevel.Word:return u=[],o.props.ocrData.map(function(i,r){i.lines.map(function(i,f){i.words.map(function(i,e){u.push(React.createElement(t.TextRecognitionWord,{key:"".concat(r,"-").concat(f,"-").concat(e),word:i,dataIndex:{region:r,line:f,word:e},htmlElements:n=="mask"?null:o.wordElements,elementType:n,selected:i.selected,textEnabled:o.renderText,createBbox:o.createBbox,selectText:o.selectText}))})})}),u}},o.props.ocrData||o.processOcrData(),o.enableMobileView=i.isMobileViewEnabled(),o.setConfigProps(e),o.isTextTranslateEnabled=(k=i.gdlc("gtc"))===null||k===void 0?void 0:k.itte,o.deafultShowCloseIcon=(d=i.gdlc("gtrc"))===null||d===void 0?void 0:d.civ,o.showTextModuleInVS=(g=i.gdlc("gtrc"))===null||g===void 0?void 0:g.stm,o.isFixTextModeIconEnabled=(nt=i.gpc())===null||nt===void 0?void 0:nt.ftoe,o}return __extends(v,h),v.prototype.componentDidMount=function(){this._isMounted=!0;this.isTextTranslateEnabled&&this.props.imageElement&&this.createImageBitmap()},v.prototype.componentWillUpdate=function(){this.resetHtmlReferences()},v.prototype.componentDidUpdate=function(n){this.props.regions!=n.regions&&this.processOcrData()},v.prototype.componentWillReceiveProps=function(n){this.props.config!=n.config&&this.setConfigProps(n);this.isTextTranslateEnabled&&this.props.imageElement!==n.imageElement&&this.createImageBitmap()},v.prototype.componentWillUnmount=function(){this._isMounted=!1},v.prototype.createImageBitmap=function(){var t=this,n=this.props.imageElement;n&&n.complete&&n.naturalWidth!==0&&n.naturalHeight!==0&&typeof createImageBitmap!==f&&createImageBitmap(n).then(function(n){t._isMounted&&(t.imageBitmap=n,t.forceUpdate())})},v.prototype.setConfigProps=function(n){n.config&&(this.showHotspotWithoutHover=n.config.shwoh,this.tooltipEnabled=n.config.te,this.renderLevel=n.config.rl,this.renderText=n.config.rt,this.renderSvg=n.config.rs,this.enableDragSelection=n.config.eds)},v.prototype.resetHtmlReferences=function(){this.regionElements=[];this.lineElements=[];this.wordElements=[]},v.prototype.processOcrData=function(){var n=this,t;this.props.regions&&(t=this.props.regions.map(function(t){return t.selected=!1,t.lines.sort(function(t,i){return n.compareBbox(t.boundingBox,i.boundingBox,n.epsilon)}),t.lines=t.lines.map(function(t){return t.selected=!1,t.words&&(t.words.sort(function(t,i){return n.compareBbox(t.boundingBox,i.boundingBox,n.epsilon)}),t.words=t.words.map(function(n){return n.selected=!1,n})),t}),t}),this.props.sortOcrData(t))},v.prototype.getOcrData=function(n){return n.region>=0&&n.line>=0&&n.word>=0?this.props.ocrData[n.region].lines[n.line].words[n.word]:n.region>=0&&n.line>=0?this.props.ocrData[n.region].lines[n.line]:n.region>=0?this.props.ocrData[n.region]:void 0},v.prototype.render=function(){var n=this;if((!r.ivs(this.props.viewType)||this.props.enableActionsFromIntent&&this.props.inTextMode||this.showTextModuleInVS)&&this.props&&this.props.config&&this.props.config.e&&this.props.ocrData&&this.props.ocrData.length>0){var t="text_recognition_cont",u="text_mode_hotspot",f="close_text_mode",c="mask_container";!this.isTranslateModuleSelected()&&(this.showHotspotWithoutHover||this.props.inTextMode||this.props.inTextModePreview)?t+=e:this.isTranslateModuleSelected()&&(t+=this.props.inTextMode?e:o);(this.props.inTextMode||this.props.inTextModePreview)&&(c+=e,this.props.inTextMode?(u+=o,f+=e):(u+=e,f+=o,t+=l));var a=this.props.config.tt,v=this.props.config.extm,y=this.tooltipEnabled?{"data-tooltip":a}:{title:a},p=this.tooltipEnabled?{"data-tooltip":v}:{title:v},s=this.props.ocrData[0].lines&&this.props.ocrData[0].lines.length>0?this.props.ocrData[0].lines[0]:null,h=s&&s.boundingBox&&this.hotspotInfo?this.hotspotInfo(s.boundingBox,this.props.imageHeight):null,w=h?{left:this.toPercentage(h.left),top:this.toPercentage(h.top)}:{left:this.toPercentage(this.defaultHotspotLocation),top:this.toPercentage(this.defaultHotspotLocation)},i={width:this.props.imageWidth,height:this.props.imageHeight};return React.createElement("div",{className:t,draggable:!0,onDragStart:this.handleDragStartEvent},!this.enableMobileView&&!this.hideCloseButton()&&React.createElement("span",__assign({},p,{className:f,onMouseDown:function(){return n.toggleTextMode()},onTouchEnd:function(){return n.toggleTextMode()}}),React.createElement("span",{className:"icon"})),!this.enableMobileView&&this.showTextModeIcon()&&React.createElement("span",__assign({},y,{className:u,style:w,onMouseDown:function(){return n.toggleTextMode()},onTouchEnd:function(){return n.toggleTextMode()}}),React.createElement("span",{className:"core"})),!this.isTranslateModuleSelected()&&this.renderSvg?React.createElement("svg",{className:c,style:i},React.createElement("defs",null,React.createElement("mask",{id:"text_mode_mask"},React.createElement("rect",{className:"text_mode_opaque",x:"0",y:"0",style:i}),React.createElement("g",{viewBox:"0 0 100 100"},this.renderTextBoxes("mask")))),React.createElement("rect",{className:"text_mode_bg",x:"0",y:"0",style:i,mask:"url(#text_mode_mask)"}),React.createElement("g",{id:"text_mode_borders",viewBox:"0 0 100 100"},this.renderTextBoxes("border"))):React.createElement(SharedComponent.AccessibleComponent,{style:i,elementName:"div",role:"listbox"},this.renderTextBoxes()))}return null},v}(React.Component),y=function(n){return{changeTextMode:function(t){typeof ImageDetailActions.changeImageDetailMode!=f&&n(ImageDetailActions.changeImageDetailMode(t?h.Text:h.Default))},changeSelectedTextIndex:function(t){typeof ImageDetailActions.changeSelectedTextIndex!=f&&n(ImageDetailActions.changeSelectedTextIndex(t))},changeSelectedModule:function(t){n(ImageDetailActions.changeInsightsSelectedModule(t))},sortOcrData:function(t){typeof ImageDetailActions.sortOcrData!=f&&n(ImageDetailActions.sortOcrData(t))}}},p=function(n){var t,e=i.getInsightsViewState(n),s=i.getViewType(n),o=e===null||e===void 0?void 0:e.selectedModule,h=o===r.getModuleName(u.translation)?(t=i===null||i===void 0?void 0:i.gtrtxt)===null||t===void 0?void 0:t.call(i,n):i.getOcrText(n);return{config:i.gdlc("gtrc"),regions:h,inTextMode:typeof i.itm!==f?i.itm(n):!1,ocrData:i.getSortedOcrData(n),ig:i.getCurrentImpressionId(n),inTextModePreview:i.getInTextModePreview(n),selectedModule:o,viewType:s}},w=ReactRedux.connect(p,y);n.ImageDetail.TextRecognition=w(v);n.ImageDetail.TextRecognition.displayName="TextRecognition"})(t=n.ImageDetail||(n.ImageDetail={}))}(Multimedia||(Multimedia={}))